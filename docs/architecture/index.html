<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Kiến trúc · Nền tảng IOT Makipos</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="&lt;!-- Check the [documentation](https://docusaurus.io) for how to use Docusaurus. --&gt;"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Kiến trúc · Nền tảng IOT Makipos"/><meta property="og:type" content="website"/><meta property="og:url" content="https://makipos.github.io/iot-server/"/><meta property="og:description" content="&lt;!-- Check the [documentation](https://docusaurus.io) for how to use Docusaurus. --&gt;"/><meta property="og:image" content="https://makipos.github.io/iot-server/img/undraw_online.svg"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://makipos.github.io/iot-server/img/undraw_tweetstorm.svg"/><link rel="shortcut icon" href="/iot-server/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/iot-server/js/scrollSpy.js"></script><link rel="stylesheet" href="/iot-server/css/main.css"/><script src="/iot-server/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/iot-server/"><img class="logo" src="/iot-server/img/favicon.ico" alt="Nền tảng IOT Makipos"/><h2 class="headerTitleWithLogo">Nền tảng IOT Makipos</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/iot-server/docs/feature" target="_self">Chức năng</a></li><li class="siteNavGroupActive siteNavItemActive"><a href="/iot-server/docs/architecture" target="_self">Kiến trúc</a></li><li class=""><a href="/iot-server/docs/installation" target="_self">Hướng dẫn</a></li><li class=""><a href="/iot-server/api" target="_self">API</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Kiến trúc</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Kiến trúc</h3><ul class=""><li class="navListItem navListItemActive"><a class="navItem" href="/iot-server/docs/architecture">Tổng quan</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Service</h3><ul class=""><li class="navListItem"><a class="navItem" href="/iot-server/docs/database">Database</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/gateway">Gateway</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/users_service">User</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/devices_service">Thiết bị</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/relations_service">Quyền sở hữu</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/automatic_service">Luật tự động</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/update_service">Cập nhật OTA</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/webmanager">Web quản trị</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">Bảo mật</h3><ul class=""><li class="navListItem"><a class="navItem" href="/iot-server/docs/network">Mạng kết nối</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/mqtt">MQTT</a></li><li class="navListItem"><a class="navItem" href="/iot-server/docs/http">HTTP</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Kiến trúc</h1></header><article><div><span><!-- Check the [documentation](https://docusaurus.io) for how to use Docusaurus. -->
<h2><a class="anchor" aria-hidden="true" id="tổng-quan"></a><a href="#tổng-quan" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Tổng quan</h2>
<p>Mô hình Microservice sử dụng docker swarm cho phép kiến trúc server hoạt động theo cluster, giúp khả năng mở rộng linh hoạt, đáp ứng nhu cầu chịu tải cao và mở rộng tính năng</p>
<p><img src="https://makihome.vn/wp-content/uploads/2020/07/service_network2.png" alt="" title="kiến trúc"></p>
<h2><a class="anchor" aria-hidden="true" id="firewall"></a><a href="#firewall" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Firewall</h2>
<p>Cụm server đặt trong mạng nội bộ đứng sau firewall, chỉ cho phép dữ liệu tới các cổng dịch vụ cho phép</p>
<ol>
<li>80, 443 : Cổng dịch vụ của web quản trị</li>
<li>22: Cổng kết nối ssh</li>
<li>3020: Cổng kết nối cho thiết bị sử dụng giao thức tcp socket</li>
<li>3028, 3029: Cổng dịch vụ api http</li>
<li>1883, 8083, 8883, 8084: Cổng dịch cho kết nối mqtt (mqtt, ws, mqttssl, wss)</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="giao-thức-kết-nối"></a><a href="#giao-thức-kết-nối" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Giao thức kết nối</h2>
<p>Makipos iot platform cung cấp nhiều giao diện API cho phép thiết bị và người dùng (mobile app, web) kết nối. Có thể bổ sung thêm bằng cách xây dựng service gateway tương ứng.</p>
<ol>
<li>HTTP (HTTPS)</li>
<li>MQTT (WS, WSS ,TCP, SSL)</li>
<li>TCP</li>
<li>SMS : Do đặc thù của kết nối sms, server sms gateway được đặt tại 1 máy trạm nội bộ riêng có sử dụng SIM module. Các kết nối, giao tiếp sử dụng giao thức này được thực hiện trung gian qua server độc lập này sử dụng (API, webhook)</li>
</ol>
<h2><a class="anchor" aria-hidden="true" id="frontend"></a><a href="#frontend" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Frontend</h2>
<p>Hoạt động của hệ thống IOT backend không thể thiếu giao diện quản trị hệ thống và dữ liệu dành cho người dùng.</p>
<p>Nhóm service website quản trị được tách biệt với lõi server, sử dụng mạng overlay độc lập, giao tiếp với backend hoàn toàn thông qua giao diện API bảo mật.</p>
<p>Dễ dàng phát triển những giao diện quản trị đặc thù cho từng mục đích.</p>
<h2><a class="anchor" aria-hidden="true" id="api-service"></a><a href="#api-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>API Service</h2>
<p>Nhóm service bao gồm cơ sở dữ liệu, mqtt broker, API service hoạt động trong mạng riêng (overlay network của docker swarm).</p>
<p>Mỗi phần chức năng được tách ra thành service docker container riêng, thuận tiện cho việc cập nhật phát triển từng nhóm chức năng riêng lẻ, mở rộng nhiều container song song cho từng service đáp ứng tương thích với hoạt động thực tế.</p>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 7/31/2020 by tranphuong.080</em></div><div class="docs-prevnext"><a class="docs-next button" href="/iot-server/docs/database"><span>Database</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#tổng-quan">Tổng quan</a></li><li><a href="#firewall">Firewall</a></li><li><a href="#giao-thức-kết-nối">Giao thức kết nối</a></li><li><a href="#frontend">Frontend</a></li><li><a href="#api-service">API Service</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/iot-server/" class="nav-home"><img src="/iot-server/img/favicon.ico" alt="Nền tảng IOT Makipos" width="66" height="58"/></a><div><h5>Docs</h5></div><div><h5>Community</h5><a href="https://www.facebook.com/makihomevn/" target="_blank" rel="noreferrer noopener">Facebook</a></div><div><h5>More</h5><a href="/iot-server/blog">Blog</a><a href="https://github.com/makipos/iot-server">GitHub</a></div></section><section class="copyright">Copyright © 2018 Makipos</section></footer></div></body></html>