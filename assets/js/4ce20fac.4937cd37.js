"use strict";(self.webpackChunkwebsite_2=self.webpackChunkwebsite_2||[]).push([[316],{3905:function(n,t,e){e.d(t,{Zo:function(){return p},kt:function(){return m}});var i=e(7294);function a(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function r(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,i)}return e}function l(n){for(var t=1;t<arguments.length;t++){var e=null!=arguments[t]?arguments[t]:{};t%2?r(Object(e),!0).forEach((function(t){a(n,t,e[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(e)):r(Object(e)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(e,t))}))}return n}function c(n,t){if(null==n)return{};var e,i,a=function(n,t){if(null==n)return{};var e,i,a={},r=Object.keys(n);for(i=0;i<r.length;i++)e=r[i],t.indexOf(e)>=0||(a[e]=n[e]);return a}(n,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);for(i=0;i<r.length;i++)e=r[i],t.indexOf(e)>=0||Object.prototype.propertyIsEnumerable.call(n,e)&&(a[e]=n[e])}return a}var o=i.createContext({}),u=function(n){var t=i.useContext(o),e=t;return n&&(e="function"==typeof n?n(t):l(l({},t),n)),e},p=function(n){var t=u(n.components);return i.createElement(o.Provider,{value:t},n.children)},d={inlineCode:"code",wrapper:function(n){var t=n.children;return i.createElement(i.Fragment,{},t)}},h=i.forwardRef((function(n,t){var e=n.components,a=n.mdxType,r=n.originalType,o=n.parentName,p=c(n,["components","mdxType","originalType","parentName"]),h=u(e),m=a,k=h["".concat(o,".").concat(m)]||h[m]||d[m]||r;return e?i.createElement(k,l(l({ref:t},p),{},{components:e})):i.createElement(k,l({ref:t},p))}));function m(n,t){var e=arguments,a=t&&t.mdxType;if("string"==typeof n||a){var r=e.length,l=new Array(r);l[0]=h;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=n,c.mdxType="string"==typeof n?n:a,l[1]=c;for(var u=2;u<r;u++)l[u]=e[u];return i.createElement.apply(null,l)}return i.createElement.apply(null,e)}h.displayName="MDXCreateElement"},4692:function(n,t,e){e.r(t),e.d(t,{frontMatter:function(){return c},contentTitle:function(){return o},metadata:function(){return u},toc:function(){return p},default:function(){return h}});var i=e(7462),a=e(3366),r=(e(7294),e(3905)),l=["components"],c={title:"Ph\xe2n quy\u1ec1n"},o=void 0,u={unversionedId:"tutorial/function/roles",id:"tutorial/function/roles",isDocsHomePage:!1,title:"Ph\xe2n quy\u1ec1n",description:"H\u01b0\u1edbng d\u1eabn s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng x\xe1c th\u1ef1c ph\xe2n quy\u1ec1n",source:"@site/docs/tutorial/function/roles.md",sourceDirName:"tutorial/function",slug:"/tutorial/function/roles",permalink:"/iot-server/docs/tutorial/function/roles",tags:[],version:"current",lastUpdatedBy:"tranphuong.080",lastUpdatedAt:1640942510,formattedLastUpdatedAt:"12/31/2021",frontMatter:{title:"Ph\xe2n quy\u1ec1n"},sidebar:"tutorial",previous:{title:"C\xe0i \u0111\u1eb7t wifi",permalink:"/iot-server/docs/tutorial/connect/wificonfig"},next:{title:"Gi\xe1m s\xe1t",permalink:"/iot-server/docs/tutorial/mantain/monitor"}},p=[{value:"C\u01a1 ch\u1ebf",id:"c\u01a1-ch\u1ebf",children:[{value:"M\u1ed7i HTTP request s\u1ebd bao g\u1ed3m c\xe1c th\xf4ng tin",id:"m\u1ed7i-http-request-s\u1ebd-bao-g\u1ed3m-c\xe1c-th\xf4ng-tin",children:[]},{value:"Th\xf4ng tin c\u1ee7a 1 cu\u1ed9c g\u1ecdi \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh nh\u01b0 sau",id:"th\xf4ng-tin-c\u1ee7a-1-cu\u1ed9c-g\u1ecdi-\u0111\u01b0\u1ee3c-x\xe1c-\u0111\u1ecbnh-nh\u01b0-sau",children:[]},{value:"Th\xf4ng tin Roles c\u1ee7a m\u1ed9t t\xe0i kho\u1ea3n",id:"th\xf4ng-tin-roles-c\u1ee7a-m\u1ed9t-t\xe0i-kho\u1ea3n",children:[]},{value:"Qu\xe1 tr\xecnh x\u1eed l\xfd",id:"qu\xe1-tr\xecnh-x\u1eed-l\xfd",children:[]}]},{value:"C\u1ea5u tr\xfac D\u1eef li\u1ec7u ph\xe2n quy\u1ec1n",id:"c\u1ea5u-tr\xfac-d\u1eef-li\u1ec7u-ph\xe2n-quy\u1ec1n",children:[{value:"Mongoose Schema",id:"mongoose-schema",children:[]},{value:"Gi\xe1 tr\u1ecb c\u1ee7a tr\u01b0\u1eddng th\xf4ng tin <code>entity</code>",id:"gi\xe1-tr\u1ecb-c\u1ee7a-tr\u01b0\u1eddng-th\xf4ng-tin-entity",children:[]}]},{value:"V\xed d\u1ee5",id:"v\xed-d\u1ee5",children:[{value:"Api endpoint <code>users</code>",id:"api-endpoint-users",children:[]}]},{value:"Giao di\u1ec7n",id:"giao-di\u1ec7n",children:[{value:"Giao di\u1ec7n qu\u1ea3n l\xfd ph\xe2n quy\u1ec1n",id:"giao-di\u1ec7n-qu\u1ea3n-l\xfd-ph\xe2n-quy\u1ec1n",children:[]},{value:"Giao di\u1ec7n \u0111i\u1ec1u ch\u1ec9nh ph\xe2n quy\u1ec1n cho 1 API endpoint",id:"giao-di\u1ec7n-\u0111i\u1ec1u-ch\u1ec9nh-ph\xe2n-quy\u1ec1n-cho-1-api-endpoint",children:[]}]}],d={toc:p};function h(n){var t=n.components,c=(0,a.Z)(n,l);return(0,r.kt)("wrapper",(0,i.Z)({},d,c,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"H\u01b0\u1edbng d\u1eabn s\u1eed d\u1ee5ng ch\u1ee9c n\u0103ng ",(0,r.kt)("a",{parentName:"p",href:"/iot-server/docs/overview/security/http"},"x\xe1c th\u1ef1c ph\xe2n quy\u1ec1n")),(0,r.kt)("h2",{id:"c\u01a1-ch\u1ebf"},"C\u01a1 ch\u1ebf"),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"https://makihome.vn/wp-content/uploads/2020/07/http-secure.png",alt:null})),(0,r.kt)("h3",{id:"m\u1ed7i-http-request-s\u1ebd-bao-g\u1ed3m-c\xe1c-th\xf4ng-tin"},"M\u1ed7i HTTP request s\u1ebd bao g\u1ed3m c\xe1c th\xf4ng tin"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Headers : header c\u1ee7a request (ch\u1ee9a m\xe3 token x\xe1c th\u1ef1c)"),(0,r.kt)("li",{parentName:"ul"},"URL : ",(0,r.kt)("inlineCode",{parentName:"li"},"protocol"),"://",(0,r.kt)("inlineCode",{parentName:"li"},"domain"),":",(0,r.kt)("inlineCode",{parentName:"li"},"port"),"/",(0,r.kt)("inlineCode",{parentName:"li"},"path"),"[/",(0,r.kt)("inlineCode",{parentName:"li"},"id"),"][?`params query`]"),(0,r.kt)("li",{parentName:"ul"},"Method : Rest API tu\xe2n theo c\u1ea5u tr\xfac s\u1eed d\u1ee5ng HTTP method nh\u01b0 sau",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"GET c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : L\u1ea5y th\xf4ng tin c\u1ee7a m\u1ed9t b\u1ea3n ghi c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ul"},"GET kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : L\u1ea5y th\xf4ng tin c\u1ee7a t\u1ea5t c\u1ea3 c\xe1c b\u1ea3n ghi th\u1ecfa m\xe3n ",(0,r.kt)("inlineCode",{parentName:"li"},"params query")),(0,r.kt)("li",{parentName:"ul"},"POST : T\u1ea1o m\u1edbi d\u1eef li\u1ec7u"),(0,r.kt)("li",{parentName:"ul"},"PATCH c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : c\u1eadp nh\u1eadt d\u1eef li\u1ec7u c\u1ee7a b\u1ea3n ghi c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ul"},"PATCH kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : c\u1eadp nh\u1eadt d\u1eef li\u1ec7u c\u1ee7a to\xe0n b\u1ed9 b\u1ea3n ghi th\u1ecfa m\xe3n ",(0,r.kt)("inlineCode",{parentName:"li"},"params query")),(0,r.kt)("li",{parentName:"ul"},"UPDATE c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : thay m\u1edbi d\u1eef li\u1ec7u c\u1ee7a b\u1ea3n ghi c\u1ee5 th\u1ec3  (",(0,r.kt)("strong",{parentName:"li"},"kh\xf4ng s\u1eed d\u1ee5ng"),")"),(0,r.kt)("li",{parentName:"ul"},"UPDATE kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : thay m\u1edbi d\u1eef li\u1ec7u c\u1ee7a to\xe0n b\u1ed9 b\u1ea3n ghi th\u1ecfa m\xe3n ",(0,r.kt)("inlineCode",{parentName:"li"},"params query")," (",(0,r.kt)("strong",{parentName:"li"},"kh\xf4ng s\u1eed d\u1ee5ng"),")"),(0,r.kt)("li",{parentName:"ul"},"DELETE c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : x\xf3a b\u1ea3n ghi c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ul"},"DELETE kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," : x\xf3a t\u1ea5t c\u1ea3 b\u1ea3n ghi th\u1ecfa m\xe3n ",(0,r.kt)("inlineCode",{parentName:"li"},"params query")))),(0,r.kt)("li",{parentName:"ul"},"Data payload (json):  Ch\u1ee9a d\u1eef li\u1ec7u cho c\xe1c cu\u1ed9c g\u1ecdi ",(0,r.kt)("inlineCode",{parentName:"li"},"POST")," ",(0,r.kt)("inlineCode",{parentName:"li"},"PATCH"))),(0,r.kt)("h3",{id:"th\xf4ng-tin-c\u1ee7a-1-cu\u1ed9c-g\u1ecdi-\u0111\u01b0\u1ee3c-x\xe1c-\u0111\u1ecbnh-nh\u01b0-sau"},"Th\xf4ng tin c\u1ee7a 1 cu\u1ed9c g\u1ecdi \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh nh\u01b0 sau"),(0,r.kt)("p",null,"L\u01b0u \xfd c\xe1c t\u1eeb vi\u1ebft \u0111\u1eadm n\xe0y s\u1ebd \u0111\u01b0\u1ee3c s\u1eed d\u1ee5ng ph\xeda d\u01b0\u1edbi"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"HEADERS")," : l\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"header")," trong cu\u1ed9c g\u1ecdi (\u0111\u01b0\u1ee3c x\u1eed l\xfd \u1edf d\u1ea1ng Object)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"PATH")," : l\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"path")," trong url t\u01b0\u01a1ng \u1ee9ng v\u1edbi 1 endpoint, service trong h\u1ec7 th\u1ed1ng. (Chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"ID")," : l\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," trong url cu\u1ed9c g\u1ecdi n\u1ebfu c\xf3 (x\xe1c \u0111\u1ecbnh \u0111\u1ed1i t\u01b0\u1ee3ng d\u1eef li\u1ec7u c\u1ee5 th\u1ec3 t\xe1c \u0111\u1ed9ng d\u1ef1a tr\xean kh\xf3a ch\xednh ",(0,r.kt)("inlineCode",{parentName:"li"},"_id")," trong c\u01a1 s\u1edf d\u1eef li\u1ec7u). (Chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"QUERY")," : l\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"params query")," trong url cu\u1ed9c g\u1ecdi, ch\u1ec9 \u0111\u1ecbnh tham s\u1ed1 l\u1ecdc c\u1ee7a c\xe1c truy v\u1ea5n t\xecm ki\u1ebfm ch\u1ec9nh s\u1eeda (Object)"),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"DATA")," : l\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"payload")," Ch\u1ee9a d\u1eef li\u1ec7u cho c\xe1c cu\u1ed9c g\u1ecdi ",(0,r.kt)("inlineCode",{parentName:"li"},"POST")," ",(0,r.kt)("inlineCode",{parentName:"li"},"PATCH")," (Object)")),(0,r.kt)("h3",{id:"th\xf4ng-tin-roles-c\u1ee7a-m\u1ed9t-t\xe0i-kho\u1ea3n"},"Th\xf4ng tin Roles c\u1ee7a m\u1ed9t t\xe0i kho\u1ea3n"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Th\xf4ng tin quy\u1ec1n h\u1ea1n c\u1ee7a m\u1ed9t t\xe0i kho\u1ea3n \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh trong ",(0,r.kt)("a",{parentName:"li",href:"/iot-server/docs/overview/database_struct#schema"},"c\u01a1 s\u1edf d\u1eef li\u1ec7u")," th\xf4ng qua tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"roles"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"roles")," l\xe0 m\u1ed9t m\u1ea3ng c\xe1c chu\u1ed7i, m\u1ed7i ph\u1ea7n t\u1eed l\xe0 t\xean c\u1ee7a 1 role."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"role")," n\xe0o \u1edf tr\u01b0\u1edbc s\u1ebd \u0111\u01b0\u1ee3c \u01b0u ti\xean duy\u1ec7t tr\u01b0\u1edbc. Qu\xe1 tr\xecnh duy\u1ec7t s\u1ebd d\u1eebng l\u1ea1i khi t\xecm \u0111\u01b0\u1ee3c c\u1ea5u h\xecnh quy\u1ec1n cho ph\xe9p"),".")),(0,r.kt)("h3",{id:"qu\xe1-tr\xecnh-x\u1eed-l\xfd"},"Qu\xe1 tr\xecnh x\u1eed l\xfd"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"C\xe1c cu\u1ed9c g\u1ecdi API \u0111i v\xe0o h\u1ec7 th\u1ed1ng s\u1ebd \u0111\u01b0\u1ee3c x\xe1c minh ng\u01b0\u1eddi d\xf9ng th\xf4ng qua JWT trong tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"Authorization"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"JWT \u0111\u01b0\u1ee3c gi\u1ea3i m\xe3, x\xe1c \u0111\u1ecbnh th\xf4ng tin t\xe0i kho\u1ea3n th\u1ef1c hi\u1ec7n cu\u1ed9c g\u1ecdi"),(0,r.kt)("li",{parentName:"ul"},"D\u1eef li\u1ec7u c\u1ee7a ng\u01b0\u1eddi d\xf9ng sau khi \u0111\u01b0\u1ee3c x\xe1c \u0111\u1ecbnh \u0111\u01b0\u1ee3c l\u01b0u trong Object ",(0,r.kt)("strong",{parentName:"li"},"USER")))),(0,r.kt)("li",{parentName:"ol"},"H\u1ec7 th\u1ed1ng l\u1ea5y th\xf4ng tin ",(0,r.kt)("inlineCode",{parentName:"li"},"roles")," c\u1ee7a t\xe0i kho\u1ea3n th\u1ef1c hi\u1ec7n cu\u1ed9c g\u1ecdi."),(0,r.kt)("li",{parentName:"ol"},"Cu\u1ed9c g\u1ecdi \u0111\u01b0\u1ee3c \u0111i\u1ec1u ch\u1ec9nh th\xf4ng qua module ph\xe2n quy\u1ec1n. Duy\u1ec7t l\u1ea7n l\u01b0\u1ee3t qua t\u1eebng role c\u1ee7a t\xe0i kho\u1ea3n."),(0,r.kt)("li",{parentName:"ol"},"Th\xf4ng tin cu\u1ed9c g\u1ecdi sau khi \u0111i\u1ec1u ch\u1ec9nh \u0111\u01b0\u1ee3c \u0111\u1ea9y t\u1edbi service.")),(0,r.kt)("h2",{id:"c\u1ea5u-tr\xfac-d\u1eef-li\u1ec7u-ph\xe2n-quy\u1ec1n"},"C\u1ea5u tr\xfac D\u1eef li\u1ec7u ph\xe2n quy\u1ec1n"),(0,r.kt)("h3",{id:"mongoose-schema"},"Mongoose Schema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"{\n  name: { type: String, trim: true, unique: true, required: true, index: true },\n  permissions: [{\n    url: { type: String },\n    method: Schema.Types.Mixed,\n    forbidden: {type: Boolean, default: false},\n    limit: {\n      whiteList: [{\n        _id: false,\n        entity: { type: String },\n        idField: { type: String },\n        idValue: [Schema.Types.Mixed]\n      }],\n      blackList: [{\n        _id: false,\n        entity: { type: String },\n        idField: { type: String },\n        idValue: [Schema.Types.Mixed]\n      }],\n      restrict: [{\n        _id: false,\n        entity: { type: String },\n        idField: { type: String },\n        idValue: Schema.Types.Mixed,\n        ownerField: { type: String },\n      }],\n      skipPostRestrict: {type: Boolean, default: false},\n      custom: [{\n        _id: false,\n        field: { type: String },\n        force: Schema.Types.Mixed,\n        range: [Schema.Types.Mixed],\n        default: Schema.Types.Mixed\n      }],\n      apiOptions: Schema.Types.Mixed\n    }\n  }]\n}\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"name")," : T\xean c\u1ee7a role"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"permissions")," : l\xe0 m\u1ea3ng ch\u1ee9a danh s\xe1ch th\xf4ng tin ph\xe2n quy\u1ec1n cho t\u1eebng API endpoint",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"url")," : l\xe0 ",(0,r.kt)("strong",{parentName:"li"},"PATH"),' (t\xean endpoint, service) x\xe1c \u0111\u1ecbnh endpoint, service m\xe0 lu\u1eadt n\xe0y t\xe1c \u0111\u1ed9ng, "all" n\u1ebfu t\xe1c \u0111\u1ed9ng l\xean t\u1ea5t c\u1ea3 endpoint'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"method")," : x\xe1c \u0111\u1ecbnh http method m\xe0 lu\u1eadt n\xe0y t\xe1c \u0111\u1ed9ng",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"find : t\u01b0\u01a1ng \u1ee9ng v\u1edbi GET kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")),(0,r.kt)("li",{parentName:"ul"},"get : t\u01b0\u01a1ng \u1ee9ng v\u1edbi GET c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")),(0,r.kt)("li",{parentName:"ul"},"create : t\u01b0\u01a1ng \u1ee9ng v\u1edbi POST : T\u1ea1o m\u1edbi d\u1eef li\u1ec7u"),(0,r.kt)("li",{parentName:"ul"},"patch : t\u01b0\u01a1ng \u1ee9ng v\u1edbi PATCH c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," v\xe0 PATCH kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")),(0,r.kt)("li",{parentName:"ul"},"update : t\u01b0\u01a1ng \u1ee9ng v\u1edbi UPDATE c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," v\xe0 UPDATE kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")),(0,r.kt)("li",{parentName:"ul"},"remove : t\u01b0\u01a1ng \u1ee9ng v\u1edbi DELETE c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," v\xe0 DELETE kh\xf4ng ",(0,r.kt)("inlineCode",{parentName:"li"},"id")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"forbidden")," : boolean , true n\u1ebfu c\u1ea5m s\u1eed d\u1ee5ng"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"limit"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"whiteList")," : M\u1ea3ng danh s\xe1ch cho ph\xe9p s\u1eed d\u1ee5ng api (tr\u1ea3 v\u1ec1 l\u1ed7i n\u1ebfu kh\xf4ng n\u1eb1m trong danh s\xe1ch)  (X\u1eed l\xfd tr\u01b0\u1edbc blackList)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idValue")," : m\u1ea3ng ch\u1ee9a danh s\xe1ch c\xe1c gi\xe1 tr\u1ecb \u0111\u01b0\u1ee3c ph\xe9p c\u1ee7a tr\u01b0\u1eddng d\u1eef li\u1ec7u tr\xean"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"blackList")," : m\u1ea3ng danh s\xe1ch kh\xf4ng cho ph\xe9p s\u1eed d\u1ee5ng api (tr\u1ea3 v\u1ec1 l\u1ed7i n\u1ebfu n\u1eb1m trong danh s\xe1ch)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idValue")," : m\u1ea3ng ch\u1ee9a danh s\xe1ch c\xe1c gi\xe1 tr\u1ecb kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p c\u1ee7a tr\u01b0\u1eddng d\u1eef li\u1ec7u tr\xean"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"restrict")," : m\u1ea3ng c\xe1c lu\u1eadt s\u1ebd t\xe1c \u0111\u1ed9ng \u0111i\u1ec1u ch\u1ec9nh l\xean ",(0,r.kt)("a",{parentName:"li",href:"#th%C3%B4ng-tin-c%E1%BB%A7a-1-cu%E1%BB%99c-g%E1%BB%8Di-%C4%91%C6%B0%E1%BB%A3c-x%C3%A1c-%C4%91%E1%BB%8Bnh-nh%C6%B0-sau"},(0,r.kt)("strong",{parentName:"a"},"QUERY")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idValue")," : N\u1ebfu kh\xf4ng s\u1eed d\u1ee5ng ",(0,r.kt)("inlineCode",{parentName:"li"},"entity"),".",(0,r.kt)("inlineCode",{parentName:"li"},"idField"),". C\xf3 th\u1ec3 s\u1eed d\u1ee5ng gi\xe1 tr\u1ecb c\u1ed1 \u0111\u1ecbnh b\u1eb1ng tr\u01b0\u1eddng n\xe0y"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"ownerField")," : chu\u1ed7i t\xean tr\u01b0\u1eddng c\u1ea7n \u0111i\u1ec1u ch\u1ec9nh trong ",(0,r.kt)("a",{parentName:"li",href:"#th%C3%B4ng-tin-c%E1%BB%A7a-1-cu%E1%BB%99c-g%E1%BB%8Di-%C4%91%C6%B0%E1%BB%A3c-x%C3%A1c-%C4%91%E1%BB%8Bnh-nh%C6%B0-sau"},(0,r.kt)("strong",{parentName:"a"},"QUERY")),". N\u1ebfu mu\u1ed1n t\xe1c \u0111\u1ed9ng ki\u1ec3m tra  ",(0,r.kt)("a",{parentName:"li",href:"#th%C3%B4ng-tin-c%E1%BB%A7a-1-cu%E1%BB%99c-g%E1%BB%8Di-%C4%91%C6%B0%E1%BB%A3c-x%C3%A1c-%C4%91%E1%BB%8Bnh-nh%C6%B0-sau"},(0,r.kt)("strong",{parentName:"a"},"ID")),", tr\u01b0\u1eddng n\xe0y s\u1ebd \u0111\u1ec3 gi\xe1 tr\u1ecb l\xe0 ",(0,r.kt)("strong",{parentName:"li"},'"',"_",'_id__"')),(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu ",(0,r.kt)("inlineCode",{parentName:"li"},"entity"),".",(0,r.kt)("inlineCode",{parentName:"li"},"idField")," kh\xf4ng t\u1ed3n t\u1ea1i th\xec b\u1ecf qua gi\u1edbi h\u1ea1n n\xe0y"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"skipPostRestrict")," : boolean , true n\u1ebfu b\u1ecf qua qu\xe1 tr\xecnh gi\u1edbi h\u1ea1n ph\xe2n quy\u1ec1n d\u1ef1a tr\xean b\u1ea3n ghi s\u1edf h\u1eefu ",(0,r.kt)("a",{parentName:"li",href:"/iot-server/docs/overview/database_struct#relations"},(0,r.kt)("inlineCode",{parentName:"a"},"relations")),". Th\u01b0\u1eddng s\u1eed d\u1ee5ng \u0111\u1ed1i v\u1edbi c\xe1c role t\xe0i kho\u1ea3n qu\u1ea3n tr\u1ecb"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"custom")," : m\u1ea3ng c\xe1c lu\u1eadt t\xe1c \u0111\u1ed9ng \u0111i\u1ec1u ch\u1ec9nh l\xean ",(0,r.kt)("a",{parentName:"li",href:"#th%C3%B4ng-tin-c%E1%BB%A7a-1-cu%E1%BB%99c-g%E1%BB%8Di-%C4%91%C6%B0%E1%BB%A3c-x%C3%A1c-%C4%91%E1%BB%8Bnh-nh%C6%B0-sau"},(0,r.kt)("strong",{parentName:"a"},"DATA")),"  (Ch\u1ec9 c\xe1c \u0111\u1ed9ng l\xean method POST v\xe0 PATCH, UPDATE)",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"field")," : Chu\u1ed7i t\xean tr\u01b0\u1eddng c\u1ea7n \u0111i\u1ec1u ch\u1ec9nh, ki\u1ec3m tra trong ",(0,r.kt)("a",{parentName:"li",href:"#th%C3%B4ng-tin-c%E1%BB%A7a-1-cu%E1%BB%99c-g%E1%BB%8Di-%C4%91%C6%B0%E1%BB%A3c-x%C3%A1c-%C4%91%E1%BB%8Bnh-nh%C6%B0-sau"},(0,r.kt)("strong",{parentName:"a"},"DATA"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"force")," : Th\xf4ng tin \u0111i\u1ec1u ch\u1ec9nh \xe9p bu\u1ed9c. C\xf3 th\u1ec3 l\xe0 1 trong 2 ki\u1ec3u",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Gi\xe1 tr\u1ecb c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ol"},"Object ch\u1ee9a th\xf4ng tin")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"clear")," : X\xf3a tr\u01b0\u1eddng n\xe0y"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu ",(0,r.kt)("inlineCode",{parentName:"li"},"entity"),".",(0,r.kt)("inlineCode",{parentName:"li"},"idField")," kh\xf4ng t\u1ed3n t\u1ea1i th\xec s\u1ebd tr\u1ea3 v\u1ec1 l\u1ed7i truy v\u1ea5n kh\xf4ng \u0111\u01b0\u1ee3c ph\xe9p"))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"range")," : N\u1ebfu kh\xf4ng s\u1eed d\u1ee5ng ",(0,r.kt)("inlineCode",{parentName:"li"},"force"),". M\u1ea3ng n\xe0y ch\u1ee9a th\xf4ng tin c\xe1c gi\xe1 tr\u1ecb \u0111\u01b0\u1ee3c ph\xe9p c\u1ee7a gi\xe1 tr\u1ecb c\u1ee7a tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"field"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"M\u1ed7i ph\u1ea7n t\u1eed c\xf3 th\u1ec3 l\xe0 :",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Gi\xe1 tr\u1ecb c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ol"},"Object ch\u1ee9a th\xf4ng tin",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity")))))),(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu gi\xe1 tr\u1ecb c\u1ee7a tr\u01b0\u1eddng d\u1eef li\u1ec7u kh\xf4ng n\u1eb1m trong gi\u1edbi h\u1ea1n n\xe0y th\xec h\u1ec7 th\u1ed1ng s\u1ebd coi nh\u01b0 lu\u1eadt n\xe0y kh\xf4ng c\xf3 t\xe1c \u0111\u1ed9ng v\xe0 b\u1ecf qua."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"default")," : Sau khi x\u1eed l\xfd c\xe1c tr\u01b0\u1eddng tr\xean, n\u1ebfu tr\u01b0\u1eddng d\u1eef li\u1ec7u kh\xf4ng t\u1ed3n t\u1ea1i trong truy v\u1ea5n. Gi\xe1 tr\u1ecb m\u1eb7c \u0111\u1ecbnh \u0111\u01b0\u1ee3c \xe1p d\u1ee5ng. C\xf3 2 ki\u1ec3u gi\xe1 tr\u1ecb:",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"G\xeda tr\u1ecb c\u1ee5 th\u1ec3"),(0,r.kt)("li",{parentName:"ol"},"Object ch\u1ee9a th\xf4ng tin:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"entity")," : t\xean object truy xu\u1ea5t th\xf4ng tin c\u1ee7a truy v\u1ea5n (chu\u1ed7i)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"idField")," : t\xean tr\u01b0\u1eddng trong object ",(0,r.kt)("inlineCode",{parentName:"li"},"entity")))))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"apiOptions")," : Object d\u1eef li\u1ec7u c\u1ea5u h\xecnh \u0111\u1eb7c th\xf9 d\xe0nh ri\xeang cho API endpoint n\u1ebfu c\xf3")))))),(0,r.kt)("h3",{id:"gi\xe1-tr\u1ecb-c\u1ee7a-tr\u01b0\u1eddng-th\xf4ng-tin-entity"},"Gi\xe1 tr\u1ecb c\u1ee7a tr\u01b0\u1eddng th\xf4ng tin ",(0,r.kt)("inlineCode",{parentName:"h3"},"entity")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"entity")," l\xe0 t\xean tr\u01b0\u1eddng c\u1ee7a Obejct ",(0,r.kt)("a",{parentName:"p",href:"https://docs.feathersjs.com/api/services.html#params"},"feathersjs params"),"\nC\xe1c tr\u01b0\u1eddng b\u1ea1n th\u01b0\u1eddng s\u1eed d\u1ee5ng l\xe0:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},'"user" : Th\xf4ng tin c\u1ee7a t\xe0i kho\u1ea3n th\u1ef1c hi\u1ec7n truy v\u1ea5n',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu t\xe0i kho\u1ea3n l\xe0 user : object th\xf4ng tin nh\u01b0 ",(0,r.kt)("a",{parentName:"li",href:"/iot-server/docs/overview/database_struct#users"},"t\u1ea1i \u0111\xe2y")),(0,r.kt)("li",{parentName:"ul"},"N\u1ebfu t\xe0i kho\u1ea3n l\xe0 device : object th\xf4ng tin nh\u01b0 ",(0,r.kt)("a",{parentName:"li",href:"/iot-server/docs/overview/database_struct#devices"},"t\u1ea1i \u0111\xe2y")))),(0,r.kt)("li",{parentName:"ol"},'"headers" : Header c\u1ee7a truy v\u1ea5n'),(0,r.kt)("li",{parentName:"ol"},'"payload" : Th\xf4ng tin trong JWT m\xe0 cu\u1ed9c g\u1ecdi s\u1eed d\u1ee5ng')),(0,r.kt)("h2",{id:"v\xed-d\u1ee5"},"V\xed d\u1ee5"),(0,r.kt)("h3",{id:"api-endpoint-users"},"Api endpoint ",(0,r.kt)("inlineCode",{parentName:"h3"},"users")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Kh\xf4ng cho ph\xe9p \u0111i\u1ec1u ch\u1ec9nh tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"roles")," v\xe0 ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," trong api ",(0,r.kt)("inlineCode",{parentName:"li"},"users"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "forbidden" : false,\n    "method" : "all",\n    "url" : "users",\n    "limit" : {\n        "skipPostRestrict" : false,\n        "custom" : [\n            {\n                "range" : [],\n                "force" : {\n                    "clear" : true\n                },\n                "field" : "roles"\n            },\n            {\n                "range" : [],\n                "force" : {\n                    "clear" : true\n                },\n                "field" : "manufacturerId"\n            }\n        ],\n        "restrict" : [],\n        "whiteList" : [],\n        "blackList" : []\n    }\n}\n')),(0,r.kt)("ol",{start:2},(0,r.kt)("li",{parentName:"ol"},"Ch\u1ec9 cho ph\xe9p l\u1ea5y v\xe0 t\xe1c \u0111\u1ed9ng l\xean th\xf4ng tin c\u1ee7a b\u1ea3n th\xe2n trong api ",(0,r.kt)("inlineCode",{parentName:"li"},"users"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "forbidden" : false,\n  "method" : "all",\n  "url" : "users",\n  "limit" : {\n      "skipPostRestrict" : false,\n      "custom" : [],\n      "restrict" : [\n          {\n              "entity" : "user",\n              "idField" : "_id",\n              "ownerField" : "_id"\n          },\n          {\n              "entity" : "user",\n              "idField" : "_id",\n              "ownerField" : "__id__"\n          }\n      ],\n      "whiteList" : [],\n      "blackList" : []\n  }\n}\n')),(0,r.kt)("ol",{start:3},(0,r.kt)("li",{parentName:"ol"},"K\u1ebft h\u1ee3p c\u1ea3 2 lu\u1eadt tr\xean")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "forbidden" : false,\n  "method" : "all",\n  "url" : "users",\n  "limit" : {\n      "skipPostRestrict" : false,\n      "custom" : [\n          {\n              "range" : [],\n              "force" : {\n                  "clear" : true\n              },\n              "field" : "roles"\n          },\n          {\n              "range" : [],\n              "force" : {\n                  "clear" : true\n              },\n              "field" : "manufacturerId"\n          }\n      ],\n      "restrict" : [\n          {\n              "entity" : "user",\n              "idField" : "_id",\n              "ownerField" : "_id"\n          },\n          {\n              "entity" : "user",\n              "idField" : "_id",\n              "ownerField" : "__id__"\n          }\n      ],\n      "whiteList" : [],\n      "blackList" : []\n  }\n}\n')),(0,r.kt)("ol",{start:4},(0,r.kt)("li",{parentName:"ol"},"Ch\u1ec9 cho ph\xe9p t\xe1c \u0111\u1ed9ng l\xean c\xe1c b\u1ea3n ghi user c\xf3 tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," b\u1eb1ng v\u1edbi ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," c\u1ee7a t\xe0i kho\u1ea3n th\u1ef1c hi\u1ec7n truy v\u1ea5n. (n\u1ebfu t\xe0i kho\u1ea3n th\u1ef1c hi\u1ec7n truy v\u1ea5n kh\xf4ng c\xf3 ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," th\xec b\u1ecf qua gi\u1edbi h\u1ea1n n\xe0y). \u0110\u1ed3ng th\u1eddi gi\u1edbi h\u1ea1n thao t\xe1c ch\u1ec9nh s\u1eeda tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," bu\u1ed9c ph\u1ea3i b\u1eb1ng ",(0,r.kt)("inlineCode",{parentName:"li"},"manufacturerId")," c\u1ee7a t\xe0i kho\u1ea3n truy v\u1ea5n, tr\u01b0\u1eddng ",(0,r.kt)("inlineCode",{parentName:"li"},"roles"),' bu\u1ed9c ph\u1ea3i n\u1eb1m trong danh s\xe1ch gi\xe1 tr\u1ecb "user","adminPartner","tester","department","cskh","agent"')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "forbidden" : false,\n  "method" : "all",\n  "url" : "users",\n  "limit" : {\n      "skipPostRestrict" : false,\n      "custom" : [\n          {\n              "range" : [],\n              "force" : {\n                  "entity" : "user",\n                  "idField" : "manufacturerId"\n              },\n              "field" : "manufacturerId"\n          },\n          {\n              "range" : [\n                  "user",\n                  "adminPartner",\n                  "tester",\n                  "department",\n                  "cskh",\n                  "agent"\n              ],\n              "field" : "roles"\n          }\n      ],\n      "restrict" : [\n          {\n              "entity" : "user",\n              "idField" : "manufacturerId",\n              "ownerField" : "manufacturerId"\n          }\n      ],\n      "whiteList" : [],\n      "blackList" : []\n  }\n}\n')),(0,r.kt)("h2",{id:"giao-di\u1ec7n"},"Giao di\u1ec7n"),(0,r.kt)("h3",{id:"giao-di\u1ec7n-qu\u1ea3n-l\xfd-ph\xe2n-quy\u1ec1n"},"Giao di\u1ec7n qu\u1ea3n l\xfd ph\xe2n quy\u1ec1n"),(0,r.kt)("p",null,(0,r.kt)("img",{src:e(5650).Z})),(0,r.kt)("h3",{id:"giao-di\u1ec7n-\u0111i\u1ec1u-ch\u1ec9nh-ph\xe2n-quy\u1ec1n-cho-1-api-endpoint"},"Giao di\u1ec7n \u0111i\u1ec1u ch\u1ec9nh ph\xe2n quy\u1ec1n cho 1 API endpoint"),(0,r.kt)("p",null,(0,r.kt)("img",{src:e(5211).Z})))}h.isMDXComponent=!0},5650:function(n,t,e){t.Z=e.p+"assets/images/roles-3eaf79fc623d9651152dd67afd693b91.png"},5211:function(n,t,e){t.Z=e.p+"assets/images/roles_edit-1111a03e23efdc6f6e4accb18c563fdd.png"}}]);